import torch

image_tokens = torch.tensor([
    [
        6965, 14447,  1052,  6172, 14447,  6172,  2428, 16226,  4945,  4945,
          6172,  6172,  1052, 14447,  5772,  5772,  6965, 14447, 14447,   601,
          6328,  1268,  7151,  4099, 14975, 14975,  6328,  2428, 14447, 14447,
         14447,  2528,  6965, 14447,  6172, 12145,  6808,  7163, 10020,  5360,
         14420,  2953,   572, 12167,  2428, 14447,  1052,  2528,  6965, 14447,
         14447,  5762,  6060,  3272, 15631,  2255, 14068,  8574, 15149,  6605,
           663, 14447, 14447,  2528,  6965, 14447,  1495,  2486,  5213, 15883,
          1586, 10997, 12016, 13357, 15525,   112,  7542, 14447, 14447,  2528,
          6965, 14447, 11904,  8173,  6605,  6001,  5852, 12607, 10228,  8694,
         14246,  6386,  8075, 14447,  1052,  2528,  6965,  1052, 14447,  2129,
          6001, 10623,  3103, 10020, 11389,  9203,  6992,  8431,   601,  2528,
          1052,  2528,  6965, 14447, 14447, 13183, 11716, 14633,  5848,  2922,
         10997, 12618,   194, 15523,  2528,  4945, 14447,  2528,  6965, 14447,
          1052,   601,  6808, 11811,  5918,  5848, 14164, 11927,  6328, 16223,
          8173,  1052,  1052,  2528,  6965, 14447,  1052,  5772,   601,   867,
         10858,  4771, 11574,  5839, 12062,  8493,  1052, 14447, 14447,  2528,
          6965, 14447,   601,  6805,  1268,  2779, 14793, 11096,  8173,   981,
          7054,   663,  6328,  4945, 14447,  2528,  6965,  2528, 12187,  1268,
         15729, 14248,  3804,  1972, 11718, 12672,  8269,  4135, 15891, 13579,
          2528,  2528,  6965,  1495, 12062, 10278,  3424,  9453,  9514, 14037,
         10858,  4629, 15149, 15558,  4301,  8770,  2428,  2528,  6965,  6805,
          2779,  7576, 16242,  4319,  6274,  5522,  9470,  7696,   351,  9899,
         11004,  9032, 14447,  2528, 11196,  6172, 11665, 14793,  7407, 15978,
          4158,  8527,  3516, 15631,  2486,   128, 15631,  4629,  2528,  8493,
         11591,  4815,  1495, 15558, 11228,  2428, 13512, 11497, 11941, 10549,
          7372, 10805,  2428,  1052,  5772,  5305
    ]
], dtype=torch.int32)

import coremltools as ct

detokenizer = ct.models.MLModel('detokenizer.mlpackage')

print(detokenizer)

images = detokenizer.predict({
    'image_tokens': image_tokens
})

print(images['var_2596'][0].shape, images['var_2596'][0].dtype)

from PIL import Image
import numpy as np

image = Image.fromarray(images['var_2596'][0].astype(np.uint8))

image.save('generated_ct.png')
